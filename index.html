<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jeu de Multiplication</title>
  <link rel="icon" href="favicon.ico" />
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }

    #jeu {
      border: 4px solid black;
      padding: 20px;
      width: 300px;
      margin: 20px auto;
    }

    body.dark {
      background-color: #111;
      color: white;
    }

    body.dark #jeu {
      border-color: red;
    }

    #auth input {
      margin: 5px;
    }
  </style>
</head>
<body>
  <div id="auth">
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Mot de passe" />
    <button id="signup">S'inscrire</button>
    <button id="login">Se connecter</button>
    <button id="logout" style="display:none;">Se d√©connecter</button>
    <p id="user-info"></p>
  </div>

  <div id="game" style="display:none;">
    <h1>Multiplication</h1>
    <label>Nombre de questions : <input type="number" id="nombre-questions" min="1" value="5"/></label><br>
    <label><input type="checkbox" id="mode-grand-nombre" /> Mode Grand Nombre</label><br>
    <label><input type="checkbox" id="mode-grand-defi" /> Mode Grand D√©fi</label><br>
    <label><input type="checkbox" id="mode-sombre" /> Mode Sombre</label><br>
    <button onclick="lancerPartie()">Lancer la partie</button>

    <div id="jeu">
      <p id="question"></p>
      <input type="number" id="user-answer" placeholder="R√©ponse" />
      <button id="btn-verifier" onclick="verifier()">V√©rifier</button>
      <p id="chrono"></p>
      <p id="feedback"></p>
      <p>Score : <span id="score">0</span></p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCwSUJwGsD5BNwuKr8DhhMVYdfMEiLi3Es",
      authDomain: "bghj-c5fa8.firebaseapp.com",
      projectId: "bghj-c5fa8",
      storageBucket: "bghj-c5fa8.appspot.com",
      messagingSenderId: "364930076964",
      appId: "1:364930076964:web:0f4f293ad40de2b680a3b1"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const login = document.getElementById('login');
    const signup = document.getElementById('signup');
    const logout = document.getElementById('logout');
    const game = document.getElementById('game');
    const authBox = document.getElementById('auth');
    const userInfo = document.getElementById('user-info');

    signup.onclick = () => {
      createUserWithEmailAndPassword(auth, email.value, password.value)
        .catch(e => alert(e.message));
    };

    login.onclick = () => {
      signInWithEmailAndPassword(auth, email.value, password.value)
        .catch(e => alert(e.message));
    };

    logout.onclick = () => signOut(auth);

    onAuthStateChanged(auth, user => {
      if (user) {
        userInfo.innerText = `Connect√© en tant que ${user.email}`;
        game.style.display = "block";
        authBox.style.display = "none";
        logout.style.display = "inline";
      } else {
        game.style.display = "none";
        authBox.style.display = "block";
        logout.style.display = "none";
        userInfo.innerText = "";
      }
    });

    document.getElementById("mode-sombre").addEventListener("change", function () {
      document.body.classList.toggle("dark", this.checked);
    });

    let nombre1, nombre2;
    let score = 0;
    let questionsJouees = 0;
    let questionsMax = 5;
    let tempsRestant = 10;
    let timer = null;

    document.getElementById("user-answer").addEventListener("keypress", function(e) {
      if (e.key === "Enter") verifier();
    });

    window.lancerPartie = function() {
      score = 0;
      questionsJouees = 0;
      questionsMax = parseInt(document.getElementById('nombre-questions').value);
      nouvelleQuestion();
    };

    function nouvelleQuestion() {
      if (questionsJouees >= questionsMax) return fin();

      const modeGrandNombre = document.getElementById('mode-grand-nombre').checked;
      const modeGrandDefi = document.getElementById('mode-grand-defi').checked;

      questionsJouees++;
      nombre1 = Math.floor(Math.random() * 10) + 1;
      nombre2 = modeGrandNombre ? Math.floor(Math.random() * 1000) + 1 : Math.floor(Math.random() * 10) + 1;

      document.getElementById('question').innerText = `Question ${questionsJouees}/${questionsMax} : ${nombre1} √ó ${nombre2}`;
      document.getElementById('user-answer').value = "";
      document.getElementById('feedback').innerText = "";
      document.getElementById('user-answer').disabled = false;
      document.getElementById('btn-verifier').disabled = false;

      if (timer) clearInterval(timer);
      if (modeGrandNombre && modeGrandDefi) tempsRestant = 30;
      else if (modeGrandDefi) tempsRestant = 10;
      else if (modeGrandNombre) tempsRestant = 9999;
      else tempsRestant = 10;

      afficherTimer();
      if (tempsRestant !== 9999) {
        timer = setInterval(() => {
          tempsRestant--;
          afficherTimer();
          if (tempsRestant <= 0) {
            clearInterval(timer);
            echecTemps();
          }
        }, 1000);
      }
    }

    window.verifier = function() {
      const reponse = parseInt(document.getElementById('user-answer').value);
      const bonneReponse = nombre1 * nombre2;

      if (reponse === bonneReponse) {
        document.getElementById('feedback').innerText = "‚úÖ Bonne r√©ponse !";
        score++;
      } else {
        document.getElementById('feedback').innerText = `‚ùå Faux, c'√©tait ${bonneReponse}`;
      }

      document.getElementById('score').innerText = score;
      document.getElementById('btn-verifier').disabled = true;
      document.getElementById('user-answer').disabled = true;

      setTimeout(() => nouvelleQuestion(), 2000);
    }

    function echecTemps() {
      document.getElementById('feedback').innerText = `‚è∞ Temps √©coul√© ! C'√©tait ${nombre1 * nombre2}`;
      document.getElementById('btn-verifier').disabled = true;
      document.getElementById('user-answer').disabled = true;

      setTimeout(() => nouvelleQuestion(), 2000);
    }

    function afficherTimer() {
      document.getElementById('chrono').innerText = `‚è≥ Temps restant : ${tempsRestant}s`;
    }

    function fin() {
      document.getElementById('question').innerText = `üéâ Fin de la partie ! Score final : ${score}/${questionsMax}`;
      document.getElementById('chrono').innerText = "";
    }
  </script>
</body>
</html>
