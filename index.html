<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jeu de Multiplication</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: white; color: black; }
  body.dark { background: #121212; color: white; }
  label { margin-right: 10px; }
  #feedback { margin-top: 10px; font-weight: bold; }
  #resume { margin-top: 20px; font-size: 1.2em; }
  #gif-felicitation { max-width: 150px; display: none; margin-top: 10px; }
  button { padding: 8px 12px; margin-top: 10px; }
  input[type="number"] { width: 50px; }
</style>
</head>
<body>

<h1>Jeu de Multiplication</h1>

<div>
  <label for="nombre-questions">Nombre de questions :</label>
  <input type="number" id="nombre-questions" value="10" min="1" max="100" />
</div>

<div>
  <input type="checkbox" id="mode-grand-nombre" />
  <label for="mode-grand-nombre">Mode grand nombre (1-10 √ó 1-1000)</label>
</div>

<div>
  <input type="checkbox" id="defi-mode" />
  <label for="defi-mode">Mode d√©fi (timer activ√©)</label>
</div>

<div>
  <button onclick="toggleMode()">Changer mode clair/sombre</button>
  <button onclick="lancerPartie()">Lancer la partie</button>
</div>

<hr />

<div id="question">Cliquez sur "Lancer la partie" pour commencer</div>
<div>
  <input type="number" id="user-answer" disabled />
  <button id="btn-verifier" disabled onclick="verifier()">V√©rifier</button>
</div>

<div id="chrono"></div>
<div id="feedback"></div>

<hr />

<div>Score : <span id="score">0</span> | Bonnes r√©ponses : <span id="bonnes">0</span> | Mauvaises r√©ponses : <span id="mauvaises">0</span></div>

<div id="resume" style="display:none;"></div>
<img id="gif-felicitation" src="" alt="F√©licitations" />

<script>
  let nombre1, nombre2;
  let score = 0;
  let bonnes = 0;
  let mauvaises = 0;
  let partieEnCours = false;
  let questionsMax = 10;
  let questionsJouees = 0;
  let modeGrandNombre = false;
  let defiActif = false;

  let tempsRestant = 10;
  let timerQuestionInterval = null;

  function toggleMode() {
    document.body.classList.toggle('dark');
  }

  function lancerPartie() {
    score = 0;
    bonnes = 0;
    mauvaises = 0;
    questionsJouees = 0;
    updateAffichageScore();
    document.getElementById('feedback').innerText = "";
    document.getElementById('resume').style.display = "none";
    document.getElementById('gif-felicitation').style.display = "none";
    document.getElementById('gif-felicitation').src = "";

    modeGrandNombre = document.getElementById('mode-grand-nombre').checked;
    defiActif = document.getElementById('defi-mode').checked;
    questionsMax = parseInt(document.getElementById('nombre-questions').value);
    if (isNaN(questionsMax) || questionsMax < 1) questionsMax = 10;

    partieEnCours = true;
    document.getElementById('user-answer').disabled = false;
    document.getElementById('btn-verifier').disabled = false;

    questionsJouees = 0;
    nouvelleQuestion();
  }

  function nouvelleQuestion() {
    if (!partieEnCours) return;

    if (questionsJouees >= questionsMax) {
      finDuJeu();
      return;
    }

    questionsJouees++;

    if (modeGrandNombre) {
      nombre1 = Math.floor(Math.random() * 10) + 1;
      nombre2 = Math.floor(Math.random() * 1000) + 1;
    } else {
      nombre1 = Math.floor(Math.random() * 10) + 1;
      nombre2 = Math.floor(Math.random() * 10) + 1;
    }

    document.getElementById('question').innerText = `Question ${questionsJouees} / ${questionsMax} : Combien font ${nombre1} √ó ${nombre2} ?`;
    document.getElementById('user-answer').value = "";
    document.getElementById('feedback').innerText = "";

    document.getElementById('user-answer').disabled = false;
    document.getElementById('btn-verifier').disabled = false;
    document.getElementById('user-answer').focus();

    if (defiActif) {
      tempsRestant = modeGrandNombre ? 30 : 10;
      startTimer();
    } else {
      stopTimer();
      document.getElementById('chrono').innerText = "";
    }
  }

  function startTimer() {
    afficherTimer();
    if (timerQuestionInterval) clearInterval(timerQuestionInterval);
    timerQuestionInterval = setInterval(() => {
      tempsRestant--;
      afficherTimer();

      if (tempsRestant <= 0) {
        clearInterval(timerQuestionInterval);
        tempsEcoule();
      }
    }, 1000);
  }

  function stopTimer() {
    if (timerQuestionInterval) clearInterval(timerQuestionInterval);
  }

  function afficherTimer() {
    document.getElementById('chrono').innerText = `‚è≥ Temps restant : ${tempsRestant} sec`;
  }

  function tempsEcoule() {
    document.getElementById('btn-verifier').disabled = true;
    document.getElementById('user-answer').disabled = true;

    mauvaises++;
    updateAffichageScore();
    const bonneReponse = nombre1 * nombre2;
    document.getElementById('feedback').innerText = `‚è∞ Temps √©coul√© ! La r√©ponse √©tait ${bonneReponse}.`;

    setTimeout(() => {
      if (questionsJouees >= questionsMax) {
        finDuJeu();
      } else {
        nouvelleQuestion();
      }
    }, 5000);
  }

  function verifier() {
    if (!partieEnCours) return;

    stopTimer();

    const reponse = parseInt(document.getElementById('user-answer').value);
    const bonneReponse = nombre1 * nombre2;
    const feedback = document.getElementById('feedback');

    if (isNaN(reponse)) {
      feedback.innerText = "‚õî Entrez un nombre.";
      return;
    }

    if (reponse === bonneReponse) {
      feedback.innerText = "‚úÖ Bonne r√©ponse !";
      score++;
      bonnes++;
    } else {
      feedback.innerText = `‚ùå Mauvaise r√©ponse. C'√©tait ${bonneReponse}.`;
      mauvaises++;
    }

    updateAffichageScore();

    document.getElementById('btn-verifier').disabled = true;
    document.getElementById('user-answer').disabled = true;

    setTimeout(() => {
      if (questionsJouees >= questionsMax) {
        finDuJeu();
      } else {
        nouvelleQuestion();
      }
    }, 5000);
  }

  function updateAffichageScore() {
    document.getElementById('score').innerText = score;
    document.getElementById('bonnes').innerText = bonnes;
    document.getElementById('mauvaises').innerText = mauvaises;
  }

  function finDuJeu() {
    partieEnCours = false;
    stopTimer();
    document.getElementById('user-answer').disabled = true;
    document.getElementById('btn-verifier').disabled = true;
    document.getElementById('chrono').innerText = "";

    const total = bonnes + mauvaises;
    const pourcentage = total > 0 ? Math.round((score / total) * 100) : 0;

    const resumeDiv = document.getElementById('resume');
    resumeDiv.style.display = "block";
    resumeDiv.innerHTML = `
      üéâ Fin du jeu !<br/>
      Score final : ${score} / ${total} (${pourcentage}%)<br/>
      ‚úÖ Bonnes r√©ponses : ${bonnes}<br/>
      ‚ùå Erreurs : ${mauvaises}
    `;

    const gif = document.getElementById('gif-felicitation');
    // Gifs h√©berg√©s sur Imgur
    if (pourcentage > 80) {
      gif.src = "https://i.imgur.com/1iJfskW.gif"; // super happy
    } else if (pourcentage > 50) {
      gif.src = "https://i.imgur.com/Lx3JjQq.gif"; // content
    } else {
      gif.src = "https://i.imgur.com/5Yz8BoU.gif"; // triste
    }
    gif.style.display = "block";
  }
</script>

</body>
</html>
