<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Jeu de Multiplication</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="favicon.ico">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background-color: #f0f0f0;
      transition: background-color 0.3s;
      color: #000;
    }
    body.dark {
      background-color: #121212;
      color: #fff;
    }
    #container {
      border: 3px solid black;
      padding: 20px;
      border-radius: 10px;
      max-width: 500px;
      margin: auto;
    }
    body.dark #container {
      border-color: red;
    }
    input, select, button {
      padding: 10px;
      font-size: 1em;
      margin: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
    }
    button:hover {
      background-color: #0056b3;
    }
    #logoutBtn {
      background-color: red;
      color: white;
      float: right;
      margin-bottom: 10px;
    }
    #toggleMode {
      margin-bottom: 20px;
    }
    #summary {
      margin-top: 20px;
    }
    img {
      max-width: 100px;
      margin-top: 10px;
    }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
</head>
<body>
  <button id="logoutBtn">D√©connexion</button>
  <h1>Jeu de Multiplication</h1>
  <button id="toggleMode">Mode Sombre / Clair</button>
  <div id="container">
    <label for="numQuestions">Nombre de questions :</label>
    <select id="numQuestions">
      <option value="5">5</option>
      <option value="10" selected>10</option>
      <option value="15">15</option>
      <option value="20">20</option>
    </select><br>

    <label><input type="checkbox" id="grandDefi"> Grand D√©fi</label>
    <label><input type="checkbox" id="grandNombre"> Grand Nombre</label><br>

    <div id="question" style="font-size: 2em; margin: 20px;"></div>
    <input type="number" id="answer" placeholder="Votre r√©ponse">
    <button id="submit">Valider</button>

    <div id="score">Score : 0</div>
    <div id="timer">Temps restant : ‚àû</div>
    <div id="summary"></div>
  </div>

  <script>
    // Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCwSUJwGsD5BNwuKr8DhhMVYdfMEiLi3Es",
      authDomain: "bghj-c5fa8.firebaseapp.com",
      projectId: "bghj-c5fa8",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Auth check
    auth.onAuthStateChanged(user => {
      if (!user) window.location.href = "index.html";
    });

    document.getElementById("logoutBtn").onclick = () => {
      auth.signOut().then(() => window.location.href = "index.html");
    };

    // Mode sombre
    const toggleModeBtn = document.getElementById('toggleMode');
    function setDarkMode(dark) {
      if (dark) {
        document.body.classList.add('dark');
        localStorage.setItem('darkMode', 'true');
      } else {
        document.body.classList.remove('dark');
        localStorage.setItem('darkMode', 'false');
      }
    }
    setDarkMode(localStorage.getItem('darkMode') === 'true');
    toggleModeBtn.onclick = () => setDarkMode(!document.body.classList.contains('dark'));

    // Variables
    const questionDiv = document.getElementById("question");
    const answerInput = document.getElementById("answer");
    const submitBtn = document.getElementById("submit");
    const scoreDiv = document.getElementById("score");
    const timerDiv = document.getElementById("timer");
    const summaryDiv = document.getElementById("summary");

    let questions = [], index = 0, score = 0, timer, timeLeft = 0;

    function generateQuestions(count, grandNombre) {
      questions = [];
      for (let i = 0; i < count; i++) {
        const a = grandNombre ? Math.floor(Math.random() * 90) + 10 : Math.floor(Math.random() * 10);
        const b = grandNombre ? Math.floor(Math.random() * 90) + 10 : Math.floor(Math.random() * 10);
        questions.push({ a, b });
      }
    }

    function startGame() {
      score = 0;
      index = 0;
      summaryDiv.innerHTML = "";
      scoreDiv.textContent = "Score : 0";

      const grandDefi = document.getElementById("grandDefi").checked;
      const grandNombre = document.getElementById("grandNombre").checked;
      const count = parseInt(document.getElementById("numQuestions").value);

      generateQuestions(count, grandNombre);
      showQuestion();

      clearInterval(timer);
      if (grandDefi && grandNombre) {
        timeLeft = 30;
      } else if (grandDefi) {
        timeLeft = 10;
      } else {
        timeLeft = Infinity;
      }

      if (timeLeft !== Infinity) {
        timerDiv.textContent = `Temps restant : ${timeLeft}s`;
        timer = setInterval(() => {
          timeLeft--;
          timerDiv.textContent = `Temps restant : ${timeLeft}s`;
          if (timeLeft <= 0) endGame();
        }, 1000);
      } else {
        timerDiv.textContent = `Temps restant : ‚àû`;
      }
    }

    function showQuestion() {
      const q = questions[index];
      questionDiv.textContent = `${q.a} √ó ${q.b} = ?`;
      answerInput.value = "";
      answerInput.focus();
    }

    function checkAnswer() {
      const q = questions[index];
      const userAnswer = parseInt(answerInput.value);
      if (userAnswer === q.a * q.b) score++;
      index++;
      if (index < questions.length && (timeLeft > 0 || timeLeft === Infinity)) {
        showQuestion();
      } else {
        endGame();
      }
    }

    function endGame() {
      clearInterval(timer);
      questionDiv.textContent = "Fin du jeu !";
      answerInput.disabled = true;
      submitBtn.disabled = true;
      timerDiv.textContent = "";
      scoreDiv.textContent = `Score final : ${score}/${questions.length}`;

      let img = "";
      if (score === questions.length) {
        img = "üåü Excellent !";
      } else if (score >= questions.length * 0.7) {
        img = "üëç Bien jou√© !";
      } else {
        img = "üí° Tu peux t'am√©liorer !";
      }

      summaryDiv.innerHTML = `
        <p>${img}</p>
        <button onclick="location.reload()">Rejouer</button>
      `;
    }

    submitBtn.onclick = checkAnswer;
    answerInput.addEventListener("keypress", e => {
      if (e.key === "Enter") checkAnswer();
    });

    window.onload = startGame;
  </script>
</body>
</html>
